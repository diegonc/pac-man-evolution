\documentclass{article}

\usepackage[spanish]{babel}
%\usepackage[latin1]{inputenc}

\begin{document}

\section{Optimizaciones.}

\subsection{Inversión de ciclos.}

El método consiste en invertir los ciclos exteriores del método básico. Al realizar la multiplicación A x B = C con el método básico, las matrices A y C se recorren por filas y la B por columnas.
Al intercambiar el orden de los bucles, se cambia el sentido de recorrido de cada matriz, es decir, A y C por columnas y B por filas. Esto permite un mejor aprovechamiento de la localidad espacial que provee la dispocición de los elementos contiguos en la memoria bajo el criterio Column Major Order.


\subsection{B�sico con trasposici�n.}

Como se explico en el método anterior, A y C se recorren originalmente por filas. Lo que hace este método es transponer A y luego efectuar la multiplicación recorriendo A y B por columnas simultáneamente. Como se utiliza un acumulador para cada elemento de C, se realizan menor cantidad de accesos a éstos últimos, con respecto a los elementos de las otras matrices. Al igual que en el caso anterior, el beneficio se obtiene debido al aprovechamiento de la localidad espacial.

Sin embargo, el desempe�o de este m�todo se ve impactado por la penalidad de calcular la matriz traspuesta, porque deben accederse simultáneamente los elementos simétricos respecto a la diagonal (que pertenecen a distintas filas y columnas de la matriz transponer).

\subsection{Multiplicaci�n por bloques}

Es posible dividir la matriz en bloques de tama�o arbitrario y, utilizando el método básico, realizar multiplicaciones sucesivas de matrices mas pequeñas, mejorando la localidad temporal, ya que se mantienen en la caché los datos que se usarán a corto plazo.

\subsection{Multiplicaci�n por columnas.}

Este m�todo realiza la multiplicaci�n de matrices en forma incremental, efectuando todas las operaciones posibles con los elementos disponibles de una de las matrices y sumando los resultados parciales en la matriz resultado.

Utilizando las propiedades de las matrices se consiguen las siguientes equivalencias que proporcionanan fundamento matem�tico al m�todo. Por simplicidad, se utilizan matrices de 2x2.

$$
  \left[
	\begin{array}{cc}
		a_{11} & a_{12} \\
		a_{21} & a_{22}
	\end{array}
   \right]
   \left[
	\begin{array}{cc}
		b_{11} & b_{12} \\
		b_{21} & b_{22}
	\end{array}
   \right]
   =
   \left[
	\begin{array}{cc}
		c_{11} & c_{12} \\
		c_{21} & c_{22}
	\end{array}
   \right]
$$

El producto del miembro izquierdo se puede escribir como
$$
   \left(
	\left[
	\begin{array}{cc}
		a_{11} & 0 \\
		a_{21} & 0
	\end{array}
	\right]
        +
	\left[
	\begin{array}{cc}
		0 & a_{12} \\
		0 & a_{22}
	\end{array}
	\right]
   \right)
   \left(
   	\left[
	\begin{array}{cc}
		b_{11} & 0 \\
		b_{21} & 0
	\end{array}
	\right]
        +
	\left[
	\begin{array}{cc}
		0 & b_{12} \\
		0 & b_{22}
	\end{array}
	\right]
   \right)
$$

Y expandiendo los par�ntesis resulta

$$
	\left[
	\begin{array}{cc}
		a_{11} & 0 \\
		a_{21} & 0
	\end{array}
	\right]
	\left[
	\begin{array}{cc}
		b_{11} & 0 \\
		b_{21} & 0
	\end{array}
	\right]
        +
	\left[
	\begin{array}{cc}
		0 & a_{12} \\
		0 & a_{22}
	\end{array}
	\right]
	\left[
	\begin{array}{cc}
		b_{11} & 0 \\
		b_{21} & 0
	\end{array}
	\right]
	+
	\left[
	\begin{array}{cc}
		a_{11} & 0 \\
		a_{21} & 0
	\end{array}
	\right]
	\left[
	\begin{array}{cc}
		0 & b_{12} \\
		0 & b_{22}
	\end{array}
	\right]
        +
	\left[
	\begin{array}{cc}
		0 & a_{12} \\
		0 & a_{22}
	\end{array}
	\right]
	\left[
	\begin{array}{cc}
		0 & b_{12} \\
		0 & b_{22}
	\end{array}
	\right]
$$

As�, la matriz producto se puede descomponer en la siguiente suma
$$
	\left[
	\begin{array}{cc}
		a_{11} b_{11} & 0 \\
		a_{21} b_{11} & 0
	\end{array}
	\right]
        +
	\left[
	\begin{array}{cc}
		a_{12} b_{21} & 0 \\
		a_{22} b_{21} & 0
	\end{array}
	\right]
	+
	\left[
	\begin{array}{cc}
		0 & a_{11} b_{12} \\
		0 & a_{21} b_{12}
	\end{array}
	\right]
        +
	\left[
	\begin{array}{cc}
		0 & a_{12} b_{22} \\
		0 & a_{22} b_{22}
	\end{array}
	\right]
$$

Como se puede apreciar, las tres matrices se acceden por columnas. Esto resulta en una mejor utilizaci�n de la memoria cache.

Para que este método funcione correctamente, se requiere que la matriz donde se almacena el resultado haya sido inicializada en 0. Sin embargo, como esto no es tenido en cuenta en el calculo del tiempo (ya que se realiza para todos los metodos), no presenta una desventaja.

Otro factor importante es el grado de asociatividad de la cache, ya que para que no se produzca trashing tiene que tener como minimo 4 vías para evitar que se reemplacen entre si las columnas de las distintas matrices.

Por último, si el tamaño de la matriz a multiplicar es muy grande, las columnas de cada matriz no se pueden mapear completmente en cada línea de la caché obteniendo una mayor tasa de miss y una consecuente disminución del rendimiento.

\subsection{Multiplicaci�n por columnas, usando operación en bloques}

Este método es la unión de los 2 anteriores, combinando las ventajas de cada uno. Básicamente, con la operacion por bloques se logra reducir el problema que se produce en el método de multiplicación por columnas, al operar con matrices de gran tamaño. Si se escoje el valor adecuado para el tamaño de bloque, se puede lograr operar con matrices pequeñas cuyas columnas entran completamente en cada linea de la caché. De esta manera, se hace un gran aprovechamiento de la localidad espacial y temporal.

\section{Hardware utilizado}

El programa de multiplicaci�n de matrices, con cada optimizaci�n implementada, se ejecut� en dos configuraciones de hardware que se describen a continuaci�n.

\section{Corridas}

\subsection{NIETOOO}

\clearpage
\input{./matmult/celeron/matmul.salida}
\clearpage
\clearpage
\input{./matmult/celeron/matmul-3loopi.salida}
\clearpage
\input{./matmult/celeron/matmul-bloques.salida}
\clearpage
\input{./matmult/celeron/matmul-lineas.salida}
\clearpage
\input{./matmult/celeron/matmul-transp.salida}
\clearpage

\subsection{Core 2 Duo E6400}

\clearpage
\input{./matmult/core2/matmul.salida}
\clearpage
\clearpage
\input{./matmult/celeron/matmul-3loopi.salida}
\clearpage
\input{./matmult/celeron/matmul-bloques.salida}
\clearpage
\input{./matmult/celeron/matmul-lineas.salida}
\clearpage
\input{./matmult/celeron/matmul-transp.salida}
\clearpage

\end{document}
